<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Game & App Hub â€” Single Page iframe</title>
<style>
  :root { --bar:#005fa3; --bar-2:#0077cc; --white:#fff; }
  html,body{
    height:100%;
    width:100%;
    margin:0;
    padding:0;
    overflow:hidden;
    font-family: Inter, Roboto, Arial, sans-serif;
  }

  body {
    display:flex;
    flex-direction:column;
    height:100vh;
  }

  /* header/menu */
  #topbar {
    background: linear-gradient(90deg,var(--bar-2),var(--bar));
    color:var(--white);
    padding:10px 14px;
    display:flex;
    gap:12px;
    align-items:center;
    justify-content:space-between;
    flex-shrink:0;
  }
  #title { font-weight:700; font-size:16px; }
  #menu { display:flex; gap:8px; flex-wrap:wrap; align-items:center; }
  .menu-btn {
    background:transparent;
    border:1px solid rgba(255,255,255,0.14);
    color:var(--white);
    padding:8px 12px;
    border-radius:8px;
    cursor:pointer;
    font-weight:600;
    transition:transform .08s, background .12s;
  }
  .menu-btn:hover { transform:translateY(-1px); background: rgba(255,255,255,0.06); }

  /* iframe area */
  #frameWrap {
    position:relative;
    flex:1 1 auto;
    width:100%;
    display:flex;
    align-items:stretch;
    justify-content:center;
    background:black;
  }
  iframe#gameFrame {
    flex:1 1 auto;
    width:100%;
    height:100%;
    border:0;
    display:none;
    outline:none;
    z-index:10;
  }

  /* overlay controls when in-game */
  .overlay {
    position: fixed;
    top:10px;
    left:10px;
    z-index:9999;
  }
  .small-btn {
    background: rgba(255,255,255,0.12);
    color:white;
    border:0;
    padding:8px 10px;
    border-radius:8px;
    cursor:pointer;
    font-weight:600;
    backdrop-filter: blur(4px);
  }
  .hint {
    position: absolute;
    left:50%;
    top:12px;
    transform:translateX(-50%);
    background: rgba(0,0,0,0.5);
    color:white;
    padding:6px 10px;
    border-radius:8px;
    font-size:13px;
    display:none;
    z-index:15;
  }

  /* ===== FULL PAGE FILLER WITH STACKED BANNERS ===== */
  #pageFiller {
    position:absolute;
    top:0;
    left:0;
    width:100%;
    height:100%;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:flex-start;
    background:black;
    overflow-y:auto;
    z-index:5;
    padding-top:20px;
    padding-bottom:20px;
  }
  #adWrap {
    display:flex;
    flex-direction:column;
    gap:20px;
    justify-content:flex-start;
    align-items:center;
  }
  #adWrap .ad-slot {
    flex: 0 0 auto;
    display:flex;
    align-items:center;
    justify-content:center;
    overflow:hidden;
  }

  @media (max-width:640px) {
    #title { font-size:14px; }
    .menu-btn { padding:7px 10px; font-size:14px; }
    #adWrap .ad-slot { width:calc(100% - 24px); max-width:calc(100% - 24px); }
  }
</style>
</head>
<body>
  <div id="topbar">
    <div id="title">Game & App Hub</div>
    <div id="menu">
      <button class="menu-btn" data-url="https://putman10.github.io/oregon-trail/">Oregon Trail</button>
      <button class="menu-btn" data-url="https://bigjackson.github.io/Run3Source/">Run 3 (To Save Progress: https://the-sawfish.github.io/Run3Final/)</button>
      <button class="menu-btn" data-url="https://the-sawfish.github.io/chat1234567890/login.html">Chat App</button>
      <button class="menu-btn" data-url="https://the-sawfish.github.io/call-app/">Call App</button>
      <button class="menu-btn" data-url="https://clockmantellstime.github.io/unblocked/territorial.html">Territorial</button>
      <button class="menu-btn" data-url="https://clockmantellstime.github.io/unblocked/slope.html">Slope</button>
      <button class="menu-btn" data-url="https://duckmath.github.io">FEATURED: DuckMath</button>
      <button class="menu-btn" data-url="https://the-sawfish.github.io/chilibowlflash/index.html">More Games Here</button>
    </div>
  </div>

  <div id="frameWrap">
    <!-- FULL PAGE FILLER WITH STACKED ADS -->
    <div id="pageFiller">
      <div id="adWrap"></div>
    </div>

    <div class="hint" id="focusHint">Click inside the game once to enable keyboard controls</div>
    <iframe id="gameFrame" title="Game Frame" tabindex="0" allowfullscreen></iframe>
  </div>

  <div class="overlay" id="inGameOverlay" style="display:none;">
    <button id="backBtn" class="small-btn" title="Back to menu (Esc)">Back</button>
  </div>

<script>
// ---- DYNAMIC MULTIPLE ADS ---- //
const adWrap = document.getElementById('adWrap');
// How many stacked banners we want
const bannerCount = 20; // adjust as needed
for(let i=0;i<bannerCount;i++){
  const slot = document.createElement('div');
  slot.className = 'ad-slot';
  slot.innerHTML = `
<script type="text/javascript" src="//www.highperformanceformat.com/e0f1838a638a63f20b9c1251602fbec3/invoke.js"></script>
<script type="text/javascript">
atOptions = {
'key' : 'e0f1838a638a63f20b9c1251602fbec3',
'format' : 'iframe',
'height' : 60,
'width' : 468,
'params' : {}
};
</script>
<script type="text/javascript" src="//www.highperformanceformat.com/e0f1838a638a63f20b9c1251602fbec3/invoke.js"></script>`;
  adWrap.appendChild(slot);
}

// ---- GAME IFRAME & MENU LOGIC ---- //
(function(){
  const frame = document.getElementById('gameFrame');
  const menu = document.getElementById('menu');
  const topbar = document.getElementById('topbar');
  const overlay = document.getElementById('inGameOverlay');
  const backBtn = document.getElementById('backBtn');
  const hint = document.getElementById('focusHint');
  const pageFiller = document.getElementById('pageFiller');

  let currentURL = '';

  frame.setAttribute('tabindex','0');
  frame.style.outline = 'none';

  function loadGame(url){
    currentURL = url;
    frame.src = url;
    frame.style.display = 'block';
    if(pageFiller) pageFiller.style.display = 'none';
    topbar.style.display = 'none';
    overlay.style.display = 'flex';
    showHint();

    frame.onload = function(){
      try { frame.focus(); frame.contentWindow.focus(); } catch(e){}
    };
    setTimeout(()=>{ try{ frame.focus(); frame.contentWindow.focus(); }catch(e){} }, 120);
  }

  let hintTimer;
  function showHint(){
    hint.style.display = 'block';
    clearTimeout(hintTimer);
    hintTimer = setTimeout(()=> hint.style.display = 'none', 4500);
  }

  function backToMenu(){
    frame.src = 'about:blank';
    frame.style.display = 'none';
    overlay.style.display = 'none';
    topbar.style.display = 'flex';
    if(pageFiller) pageFiller.style.display = 'flex';
    currentURL = '';
  }

  menu.querySelectorAll('.menu-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      loadGame(btn.getAttribute('data-url'));
    });
  });

  backBtn.addEventListener('click', backToMenu);

  frame.addEventListener('pointerdown', () => {
    try { frame.focus(); frame.contentWindow.focus(); } catch (e) {}
  }, {passive:true});

  document.addEventListener('keydown', (e) => {
    if (!currentURL) return;
    if (e.key === 'Escape') {
      backToMenu();
      return;
    }
    const gameKeys = ['ArrowLeft','ArrowRight','ArrowUp','ArrowDown','w','a','s','d','W','A','S','D',' '];
    if (gameKeys.includes(e.key)) {
      try {
        if (document.activeElement !== frame) {
          frame.focus();
          try { frame.contentWindow.focus(); } catch(e){}
          setTimeout(()=> {
            if (document.activeElement !== frame) showHint();
          }, 80);
        }
      } catch(err){}
    }
  }, true);

  window.addEventListener('beforeunload', backToMenu);
  backToMenu();
})();

// ---- SAVE/RESTORE PROGRESS ADDON ---- //
(function(){
  const frame = document.getElementById('gameFrame');
  let currentGameKey = '';

  function storageKey(url) {
    return "gameSave_" + url;
  }

  function backupProgress() {
    if (!currentGameKey) return;
    try {
      const gameData = frame.contentWindow.localStorage;
      if (gameData) {
        const dump = {};
        for (let i=0; i<gameData.length; i++) {
          const k = gameData.key(i);
          dump[k] = gameData.getItem(k);
        }
        localStorage.setItem(currentGameKey, JSON.stringify(dump));
        console.log("Progress saved for", currentGameKey);
      }
    } catch (e) {
      console.warn("Could not access iframe localStorage (cross-origin). Progress not saved.", e);
    }
  }

  function restoreProgress(url) {
    currentGameKey = storageKey(url);
    const saved = localStorage.getItem(currentGameKey);
    if (saved) {
      try {
        const data = JSON.parse(saved);
        const gameData = frame.contentWindow.localStorage;
        if (gameData) {
          for (const [k,v] of Object.entries(data)) {
            gameData.setItem(k,v);
          }
          console.log("Progress restored for", currentGameKey);
        }
      } catch (e) {
        console.warn("Could not restore progress:", e);
      }
    }
  }

  const oldLoadGame = window.loadGame;
  window.loadGame = function(url) {
    oldLoadGame(url);
    frame.onload = () => {
      try {
        frame.contentWindow.focus();
        restoreProgress(url);
      } catch(e){}
    };
  };

  const oldBack = window.backToMenu;
  window.backToMenu = function() {
    backupProgress();
    oldBack();
  };

  window.addEventListener("beforeunload", backupProgress);
})();
</script>
</body>
</html>
